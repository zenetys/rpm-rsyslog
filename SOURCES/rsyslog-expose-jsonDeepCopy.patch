From 0afdacbd1ebe1c5198cfd96d52fc7dcc4b8b8855 Mon Sep 17 00:00:00 2001
From: Julien Thomas <jthomas@zenetys.com>
Date: Sun, 16 Aug 2020 07:16:38 +0200
Subject: [PATCH] msg: expose function jsonDeepCopy()

---
 runtime/msg.c | 4 ++--
 runtime/msg.h | 1 +
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/runtime/msg.c b/runtime/msg.c
index 0dc86c0ed..124a89692 100644
--- a/runtime/msg.c
+++ b/runtime/msg.c
@@ -423,7 +423,7 @@ static int getAPPNAMELen(smsg_t * const pM, sbool bLockMutex);
 static rsRetVal jsonPathFindParent(struct json_object *jroot, uchar *name, uchar *leaf,
 	struct json_object **parent, int bCreate);
 static uchar * jsonPathGetLeaf(uchar *name, int lenName);
-static struct json_object *jsonDeepCopy(struct json_object *src);
+struct json_object *jsonDeepCopy(struct json_object *src);
 static json_bool jsonVarExtract(struct json_object* root, const char *key, struct json_object **value);
 void getRawMsgAfterPRI(smsg_t * const pM, uchar **pBuf, int *piLen);
 
@@ -5109,7 +5109,7 @@ finalize_it:
 	RETiRet;
 }
 
-static struct json_object *
+struct json_object *
 jsonDeepCopy(struct json_object *src)
 {
 	struct json_object *dst = NULL, *json;
diff --git a/runtime/msg.h b/runtime/msg.h
index 0bbd036c7..9f50b7b45 100644
--- a/runtime/msg.h
+++ b/runtime/msg.h
@@ -240,6 +240,7 @@ unsigned short *pbMustBeFreed);
 rsRetVal msgSetJSONFromVar(smsg_t *pMsg, uchar *varname, struct svar *var, int force_reset);
 rsRetVal msgDelJSON(smsg_t *pMsg, uchar *varname);
 rsRetVal jsonFind(smsg_t *const pMsg, msgPropDescr_t *pProp, struct json_object **jsonres);
+struct json_object *jsonDeepCopy(struct json_object *src);
 
 rsRetVal msgPropDescrFill(msgPropDescr_t *pProp, uchar *name, int nameLen);
 void msgPropDescrDestruct(msgPropDescr_t *pProp);
-- 
2.21.1

